<h2 class="naslov">Dodela predmeta na realizaciji</h2>
<br>

<mat-card class="dodela-card">
    <mat-card-header>
        <mat-card-title>Dodela predmeta nastavniku</mat-card-title>
        <mat-card-subtitle>
            Izaberite nastavnika i predmet koji će realizovati
        </mat-card-subtitle>
    </mat-card-header>

    <mat-card-content>
        <form [formGroup]="form" (ngSubmit)="dodeli()" class="form-grid">

            <!-- Nastavnik -->
            <mat-form-field appearance="outline" class="w-100">
                <mat-label>Nastavnik</mat-label>
                <input matInput type="text" formControlName="nastavnikNaRealizaciji" [matAutocomplete]="autoN"
                    placeholder="Unesite ime ili prezime">
                <mat-autocomplete #autoN="matAutocomplete" [displayWith]="displayNnr">
                    <mat-option *ngFor="let nnr of (filteredNastavnici$ | async) ?? []" [value]="nnr">
                        {{ displayNnr(nnr) }}
                    </mat-option>
                </mat-autocomplete>
                <mat-error *ngIf="form.controls.nastavnikNaRealizaciji.hasError('required')">Obavezno polje.</mat-error>
            </mat-form-field>

            <!-- Predmet -->
            <mat-form-field appearance="outline" class="w-100">
                <mat-label>Predmet</mat-label>
                <input type="text" matInput formControlName="predmet" [matAutocomplete]="autoP"
                    placeholder="Unesite naziv predmeta" />
                <mat-autocomplete #autoP="matAutocomplete" [displayWith]="displayPredmet">
                    <mat-option *ngFor="let p of (filteredPredmeti$ | async) ?? []" [value]="p">
                        {{ displayPredmet(p) }}
                    </mat-option>
                </mat-autocomplete>
                <mat-error *ngIf="form.controls.predmet.hasError('required')">
                    Predmet je obavezan.
                </mat-error>
            </mat-form-field>

            <!-- Semestar(i) -->
            <mat-form-field appearance="outline" class="w-100">
                <mat-label>Semestar</mat-label>
                <mat-select formControlName="semestri" multiple>
                    <mat-option *ngFor="let s of semestri" [value]="s">
                        {{ displaySemestar(s) }}
                    </mat-option>
                </mat-select>
                <mat-error *ngIf="form.controls.semestri.hasError('required')">
                    Izaberite bar jedan semestar.
                </mat-error>
            </mat-form-field>


            <div class="actions">
                <button mat-flat-button color="primary" type="submit" [disabled]="loading || form.invalid">
                    <ng-container *ngIf="!loading">Dodeli predmet</ng-container>
                    <ng-container *ngIf="loading">&nbsp;Snima…</ng-container>
                </button>
                <button mat-stroked-button type="button" (click)="reset()" [disabled]="loading">Reset</button>
            </div>
        </form>

        <div *ngIf="errorMessage" class="alert alert-secondary mt-3" role="alert">
            {{ errorMessage }}
        </div>
    </mat-card-content>
</mat-card>