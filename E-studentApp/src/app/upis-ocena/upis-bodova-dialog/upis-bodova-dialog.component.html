<h2 mat-dialog-title>Upis bodova — kreiranje evaluacije</h2>

<mat-dialog-content>
    <form [formGroup]="form" (ngSubmit)="submit()">

        <!-- Tip evaluacije -->
        <mat-form-field appearance="outline">
            <mat-label>Tip evaluacije</mat-label>
            <mat-select formControlName="tipEvaluacijeId" required>
                <mat-option *ngFor="let t of tipoviEvaluacije" [value]="t.id">
                    {{ t.naziv }}
                </mat-option>
            </mat-select>
        </mat-form-field>

        <!-- Realizacija predmeta -->
        <mat-form-field appearance="outline">
            <mat-label>Realizacija predmeta</mat-label>
            <mat-select formControlName="realizacijaPredmetaId" required>
                <mat-option *ngFor="let r of realizacijePredmeta" [value]="r.id">
                    {{ r.predmet?.naziv || ('Predmet #' + r.predmet?.id) }}
                </mat-option>
            </mat-select>
        </mat-form-field>

        <!-- Bodovi -->
        <mat-form-field appearance="outline">
            <mat-label>Ostvareni bodovi</mat-label>
            <input matInput type="number" formControlName="ostvareniBodovi" min="0">
        </mat-form-field>

        <hr>

        <!-- Instrument evaluacije -->
        <mat-checkbox [checked]="createNewInstrument" (change)="toggleCreateInstrument($event.checked)">
            Kreiraj novi instrument (fajl)
        </mat-checkbox>

        <ng-container *ngIf="!createNewInstrument; else noviInstrument">
            <mat-form-field appearance="outline">
                <mat-label>Postojeći instrument evaluacije</mat-label>
                <mat-select formControlName="instrumentFileId">
                    <mat-option [value]="null">— bez instrumenta —</mat-option>
                    <mat-option *ngFor="let f of instrumentiEvaluacije" [value]="f.id">
                        {{ f.opis }}
                    </mat-option>
                </mat-select>
            </mat-form-field>
        </ng-container>

        <ng-template #noviInstrument>
            <mat-form-field appearance="outline">
                <mat-label>Opis instrumenta</mat-label>
                <input matInput formControlName="instrumentOpis">
            </mat-form-field>

            <mat-form-field appearance="outline">
                <mat-label>URL instrumenta</mat-label>
                <input matInput formControlName="instrumentUrl">
            </mat-form-field>
        </ng-template>

        <hr>

        <!-- Ishod -->
        <mat-checkbox [checked]="createNewIshod" (change)="toggleCreateIshod($event.checked)">
            Kreiraj novi ishod
        </mat-checkbox>

        <ng-container *ngIf="!createNewIshod; else noviIshod">
            <mat-form-field appearance="outline">
                <mat-label>Postojeći ishod</mat-label>
                <mat-select formControlName="ishodId">
                    <mat-option [value]="null">— bez ishoda —</mat-option>
                    <mat-option *ngFor="let i of ishodi" [value]="i.id">
                        {{ i.opis }}
                    </mat-option>
                </mat-select>
            </mat-form-field>
        </ng-container>

        <ng-template #noviIshod>
            <mat-form-field appearance="outline">
                <mat-label>Opis ishoda</mat-label>
                <textarea matInput formControlName="ishodOpis" rows="2"></textarea>
            </mat-form-field>

            <mat-form-field appearance="outline">
                <mat-label>Predmet za ishod</mat-label>
                <input type="text" matInput formControlName="ishodPredmet" [matAutocomplete]="autoPredmet"
                    autocomplete="off">
                <mat-autocomplete #autoPredmet="matAutocomplete" [displayWith]="displayPredmet">
                    <mat-option *ngFor="let p of filteredPredmeti$ | async" [value]="p">
                        {{ p.naziv }}
                    </mat-option>
                </mat-autocomplete>
                <!-- <mat-hint *ngIf="!form.value.ishodPredmet">
                    Ako ostaviš prazno, backend će vezati ishod za predmet iz realizacije.
                </mat-hint> -->
            </mat-form-field>

            <mat-checkbox formControlName="ishodPolozeno">
                Polozeno
            </mat-checkbox>
        </ng-template>
    </form>
</mat-dialog-content>

<mat-dialog-actions align="end">
    <button mat-stroked-button type="button" (click)="cancel()">Otkaži</button>
    <button mat-raised-button color="primary" type="submit" [disabled]="form.invalid"
        (click)="submit()">Sačuvaj</button>
</mat-dialog-actions>

<div *ngIf="errorMessage" class="alert alert-danger">{{ errorMessage }}</div>